import{_ as B,u as F,r as i,c as C,i as M,g as u,o as r,b as d,d as e,t as k,j as c,w as T,v as N,n as m,F as O,k as D,l as L,m as I}from"./index-CI7m5PnG.js";const S={id:"todoListPage",class:"bg-half"},E={class:"todo_sm"},P={href:"#todolist"},j={class:"conatiner todoListPage vhContainer"},q={class:"todoList_Content"},J={class:"inputBox"},R={class:"todoList_list"},A={class:"todoList_tab"},G={class:"todoList_items"},H={class:"todoList_item"},K={class:"todoList_label"},Q=["onUpdate:modelValue","onChange"],W=["onClick"],X={key:0,class:"todoList_empty"},Y={key:1,class:"todoList_statistics"},Z={key:0,class:"loading-overlay"},v="https://todolist-api.hexschool.io",ee={__name:"TodoListView",setup(te){const _=F(),l=i(""),w=i({nickname:"",uid:""}),n=i([]),p=i({content:""}),h=i("all"),o=i(!1),$=C(()=>n.value.filter(t=>!t.status).length),x=C(()=>{switch(h.value){case"all":return n.value;case"active":return n.value.filter(t=>!t.status);case"completed":return n.value.filter(t=>t.status);default:return[]}}),g=t=>{o.value||(h.value=t)},f=async()=>{try{o.value=!0;const t=await u.get(`${v}/todos/`,{headers:{authorization:l.value}});n.value=t.data.data}catch(t){console.log("err",t)}finally{o.value=!1}},b=async()=>{try{o.value=!0,await u.post(`${v}/todos/`,p.value,{headers:{authorization:l.value}}),p.value.content="",await f()}catch(t){console.log("err",t)}finally{o.value=!1}},z=async()=>{try{o.value=!0,await u.post(`${v}/users/sign_out`,null,{headers:{authorization:l.value}}),document.cookie="customTodoToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",_.push("/")}catch(t){console.log("err",t)}finally{o.value=!1}},V=async t=>{try{o.value=!0,await u.patch(`${v}/todos/${t}/toggle`,null,{headers:{authorization:l.value}}),await f()}catch(s){console.log("err",s)}finally{o.value=!1}},U=async t=>{try{o.value=!0,await u.delete(`${v}/todos/${t}`,{headers:{authorization:l.value}}),await f()}catch(s){console.log("err",s)}finally{o.value=!1}};return M(async()=>{l.value=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),console.log("token",l.value),l.value||(alert("沒有token"),_.push("/"));try{o.value=!0;const t=await u.get(`${v}/users/checkout`,{headers:{authorization:l.value}});w.value=t.data,await f()}catch(t){console.log("err",t),alert("請重新登入"),_.push("/")}finally{o.value=!1}}),(t,s)=>(r(),d("div",S,[e("nav",null,[s[4]||(s[4]=e("h1",null,[e("a",{href:"#"},"ONLINE TODO LIST")],-1)),e("ul",null,[e("li",E,[e("a",P,[e("span",null,k(w.value.nickname)+"的代辦",1)])]),e("li",null,[e("a",{href:"",onClick:c(z,["prevent"])},"登出")])])]),e("div",j,[e("div",q,[e("div",J,[T(e("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[0]||(s[0]=a=>p.value.content=a),required:""},null,512),[[N,p.value.content]]),e("a",{href:"#",onClick:c(b,["prevent"])},s[5]||(s[5]=[e("i",{class:"fa fa-plus"},null,-1)]))]),e("div",R,[e("ul",A,[e("li",null,[e("a",{href:"#",class:m({active:h.value==="all"}),onClick:s[1]||(s[1]=c(a=>g("all"),["prevent"]))},"全部",2)]),e("li",null,[e("a",{href:"#",class:m({active:h.value==="active"}),onClick:s[2]||(s[2]=c(a=>g("active"),["prevent"]))},"待完成",2)]),e("li",null,[e("a",{href:"#",class:m({active:h.value==="completed"}),onClick:s[3]||(s[3]=c(a=>g("completed"),["prevent"]))},"已完成",2)])]),e("div",G,[e("ul",H,[(r(!0),d(O,null,D(x.value,a=>(r(),d("li",{key:a.id},[e("label",K,[T(e("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":y=>a.status=y,onChange:y=>V(a.id)},null,40,Q),[[I,a.status]]),e("span",null,k(a.content),1)]),e("a",{href:"#",onClick:c(y=>U(a.id),["prevent"])},s[6]||(s[6]=[e("i",{class:"fa fa-times"},null,-1)]),8,W)]))),128))]),n.value.length===0?(r(),d("div",X,s[7]||(s[7]=[e("p",null,"目前尚無待辦事項",-1)]))):L("",!0),n.value.length>0?(r(),d("div",Y,[e("p",null,k($.value)+"個待完成項目",1)])):L("",!0)])])])]),o.value?(r(),d("div",Z,s[8]||(s[8]=[e("div",{class:"loading-spinner"},null,-1)]))):L("",!0)]))}},oe=B(ee,[["__scopeId","data-v-65dd89b7"]]);export{oe as default};
